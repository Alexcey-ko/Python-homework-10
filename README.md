# Python-homework-10

Выполнение домашнего задания №10. Работа с базами данных.

## Содержание

- [Python-homework-10](#python-homework-10)
  - [Содержание](#содержание)
  - [1. Быстрая установка и запуск проекта](#1-быстрая-установка-и-запуск-проекта)
  - [2. Структура проекта](#2-структура-проекта)
  - [3. Запуск приложений](#3-запуск-приложений)
  - [4. Запуск тестов](#4-запуск-тестов)

## 1. Быстрая установка и запуск проекта

Перед запуском проекта необходимо убедиться, что запущен Docker. Для быстрой установки и запуска проекта можно использовать следующий скрипт:

```cmd
git clone https://github.com/Alexcey-ko/Python-homework-10
cd Python-homework-10
pip install poetry
rem Чтобы poetry устанавливал .venv внутри проекта можно использовать параметр
rem poetry config virtualenvs.in-project true
poetry install
pip install . --editable

rem Создание и запуск контейнеров с Postgres и Redis
docker compose up --wait

rem Создание и применение alembic ревизии
mkdir alembic\versions
poetry run alembic revision --autogenerate -m "auto"
poetry run alembic upgrade head

rem Запуск тестов
poetry run pytest

rem Запуск генерации данных
poetry run python -m src.app.generators.generate_data

rem Запуск основного приложения
poetry run python src/main.py

```

## 2. Структура проекта

Исходники приложения `src/app`:

`database.py` - создание базового ORM класса и движка для подключения к Postgres.

`cache.py` - создание класса Cache для работы с Redis.

`exceptions.py` - набор исключений.

`config.py` - считывание настроек из .env.

`models` - ORM модели.

`repositories` - классы для работы с таблицами базы данных.

`services` - классы сервисы для реализации бизнес логики.

`entities` - классы, представляющие сущности данных.

`generators` - набор функций для генерации данных для таблиц БД. Для запуска генерации данных необходимо запустить модуль `generators/generate_data.py`

`client` - класс для реализации консольного приложения бронирования билетов.

## 3. Запуск приложений

В папке `scripts` лежат скрипты:

`alembic_rev_gen_and_up.cmd` - автоматическое создание ревизии Alembic и применении к БД.

`docker.cmd` - запуск Docker Compose для создания и запуска контейнеров с Postgres и Redis.

`generate_data.cmd` - запуск генерации данных в БД. Можно запускать неограниченное количество раз, но данные создаются независимыми от уже существующих. Т.е. создаются новые перевозчики, пользователе, аэропорты и зависящие от них рейсы и брони.

`run_main.cmd` - запуск основого приложения бронирования билетов.

## 4. Запуск тестов

В тестах используется модуль `testcontainers`, поэтому для успешного выполнения тестов должен быть запущен Docker.

В тестах создается контейнер с `Postgres`, в базе данных создается структура таблиц через `Base.metadata.create_all` и перед каждым тестом происходит очищение данных из всех таблиц.

Данные для тестирования создаются через `factory-boy`, классы расположены в `test/factories`.
